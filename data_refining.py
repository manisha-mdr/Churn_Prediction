# -*- coding: utf-8 -*-
"""data refining.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1ik-AWyxywPNkHbDBZascNmO5jlXqWekR
"""

#imorting librairs
import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt

# Reading the dataset
data = pd.read_csv('/content/train.csv')

data.head(-5)

#encoding the gender column
data['gender']=data['gender'].astype('category')
data['gender_code']=data['gender'].cat.codes

#checking region_category value counts
data["region_category"].value_counts()

#encoding the region_category
data['region_category'] = data['region_category'].str.lower()
data["region_category"] = data["region_category"].astype('category')
data['region_category_code']=data['region_category'].cat.codes

#checking region_category value counts
data["region_category_code"].value_counts()

#checking membership_category value counts
data["membership_category"].str.lower().value_counts()

data['membership_category'] = data['membership_category'].str.lower()
data["membership_category"] = data["membership_category"].astype('category')
data['membership_category_code']=data['membership_category'].cat.codes

#checking region_category value counts
data["membership_category_code"].value_counts()

# converting date to years
data['joining_date'] = pd.to_datetime(data['joining_date'],format='%Y-%m-%d')
data['year'] = 2021-pd.DatetimeIndex(data['joining_date']).year

#checking joined_through_referral value counts
data["joined_through_referral"].str.lower().value_counts()

data['joined_through_referral'] = data['joined_through_referral'].str.lower()
data["joined_through_referral"] = data["joined_through_referral"].astype('category')
data['joined_through_referral_code']=data['joined_through_referral'].cat.codes

#checking preferred_offer_types value counts
data["preferred_offer_types"].str.lower().value_counts()

data['preferred_offer_types'] = data['preferred_offer_types'].str.lower()
data["preferred_offer_types"] = data["preferred_offer_types"].astype('category')
data['preferred_offer_types_code']=data['preferred_offer_types'].cat.codes

#checking preferred_offer_types value counts
data["medium_of_operation"].str.lower().value_counts()

data['medium_of_operation'] = data['medium_of_operation'].str.lower()
data["medium_of_operation"] = data["medium_of_operation"].astype('category')
data['medium_of_operation_code']=data['medium_of_operation'].cat.codes

#checking preferred_offer_types value counts
data["medium_of_operation_code"].value_counts()

data["internet_option"].str.lower().value_counts()

data['internet_option'] = data['internet_option'].str.lower()
data["internet_option"] = data["internet_option"].astype('category')
data['internet_option_code']=data['internet_option'].cat.codes

data['days_since_last_login'].replace(-999,50, inplace=True)

data["points_in_wallet"].head(20)

s=pd.Series(data["points_in_wallet"])
data["points_in_wallet"]=s.interpolate(axis=0)

data["used_special_discount"].str.lower().value_counts()

data['used_special_discount'] = data['used_special_discount'].str.lower()
data["used_special_discount"] = data["used_special_discount"].astype('category')
data['used_special_discount_code']=data['used_special_discount'].cat.codes

data["offer_application_preference"].str.lower().value_counts()

data['offer_application_preference'] = data['offer_application_preference'].str.lower()
data["offer_application_preference"] = data["offer_application_preference"].astype('category')
data['offer_application_preference_code']=data['offer_application_preference'].cat.codes

data["offer_application_preference_code"].value_counts()

data["past_complaint"].str.lower().value_counts()

data['past_complaint'] = data['past_complaint'].str.lower()
data["past_complaint"] = data["past_complaint"].astype('category')
data['past_complaint_code']=data['past_complaint'].cat.codes

data["past_complaint"].str.lower().value_counts()

data['complaint_status'] = data['complaint_status'].str.lower()
data["complaint_status"] = data["complaint_status"].astype('category')
data['complaint_status_code']=data['complaint_status'].cat.codes

data["feedback"].str.lower().value_counts()

data['feedback'] = data['feedback'].str.lower()
data["feedback"] = data["feedback"].astype('category')
data['feedback_code']=data['feedback'].cat.codes

data.head(5)

dropouts = ['customer_id','Name','security_no','gender','security_no','region_category','membership_category','joining_date','joined_through_referral','referral_id',
            'preferred_offer_types','medium_of_operation','internet_option','last_visit_time','used_special_discount','offer_application_preference','past_complaint','complaint_status',
            'feedback','churn_risk_score','avg_frequency_login_days']

data = data.dropna()

score = data['churn_risk_score'].copy()

score.shape

feature = data.drop(columns=dropouts)

feature.head()

feature.shape

feature.to_csv('clean_data.csv')
score.to_csv('test_score.csv')

